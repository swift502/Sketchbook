!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cannon")):"function"==typeof define&&define.amd?define(["exports","cannon"],t):t(e.threeToCannon={},e.cannon)}(this,function(e,t){var r=function(){var e,t,r,n,o,i,s,a,u,c,f,m,d,l,p,x,y,E,h,v=[],g=[],w=0;var T=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,o,i){return e.subVectors(i,n),t.subVectors(o,n),r.crossVectors(e,t),r.normalize()}}();function b(e,t){if(void 0!==e.normal)return e.normal;var r=t[e[0]],n=t[e[2]];return f.subVectors(t[e[1]],r),m.subVectors(n,r),p.crossVectors(m,f),p.normalize(),e.normal=p.clone()}function V(e,t,r){var n=r[e[0]],o=[],i=b(e,r);t.sort(function(e,t){return o[e.x/3]=void 0!==o[e.x/3]?o[e.x/3]:i.dot(d.subVectors(e,n)),o[t.x/3]=void 0!==o[t.x/3]?o[t.x/3]:i.dot(l.subVectors(t,n)),o[e.x/3]-o[t.x/3]});var s=t.length;for(1===s&&(o[t[0].x/3]=i.dot(d.subVectors(t[0],n)));s-- >0&&o[t[s].x/3]>0;);s+1<t.length&&o[t[s+1].x/3]>0&&(e.visiblePoints=t.splice(s+1))}function R(e,t){for(var r,n=v.length,o=[e],i=t.indexOf(e.visiblePoints.pop());n-- >0;)(r=v[n])!==e&&b(r,t).dot(x.subVectors(t[i],t[r[0]]))>0&&o.push(r);var s,a,u,c,f=n=o.length,m=1===n,d=[],l=0,p=[];if(1===o.length)d=[(r=o[0])[0],r[1],r[1],r[2],r[2],r[0]],g.indexOf(r)>-1&&g.splice(g.indexOf(r),1),r.visiblePoints&&(p=p.concat(r.visiblePoints)),v.splice(v.indexOf(r),1);else for(;n-- >0;){var y;for(g.indexOf(r=o[n])>-1&&g.splice(g.indexOf(r),1),r.visiblePoints&&(p=p.concat(r.visiblePoints)),v.splice(v.indexOf(r),1),cEdgeIndex=0;cEdgeIndex<3;){for(y=!1,f=o.length,u=r[cEdgeIndex],c=r[(cEdgeIndex+1)%3];f-- >0&&!y;)if(l=0,(s=o[f])!==r)for(;l<3&&!y;)a=l+1,y=s[l]===u&&s[a%3]===c||s[l]===c&&s[a%3]===u,l++;y&&!m||(d.push(u),d.push(c)),cEdgeIndex++}}n=0;for(var E,h=d.length/2;n<h;)V(E=[d[2*n+1],i,d[2*n]],p,t),v.push(E),void 0!==E.visiblePoints&&g.push(E),n++}var H=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,o,i){e.subVectors(o,n),t.subVectors(i,n),r.subVectors(i,o);var s=t.dot(e);if(s<0)return t.dot(t);var a=e.dot(e);return s>=a?r.dot(r):t.dot(t)-s*s/a}}();return function(b){for(f=new THREE.Vector3,m=new THREE.Vector3,new THREE.Vector3,d=new THREE.Vector3,l=new THREE.Vector3,p=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,h=new THREE.Vector3,points=b.vertices,v=[],g=[],M=e=points.length,t=points.slice(0,6),w=0;M-- >0;)points[M].x<t[0].x&&(t[0]=points[M]),points[M].x>t[1].x&&(t[1]=points[M]),points[M].y<t[2].y&&(t[2]=points[M]),points[M].y<t[3].y&&(t[3]=points[M]),points[M].z<t[4].z&&(t[4]=points[M]),points[M].z<t[5].z&&(t[5]=points[M]);for(n=M=6;M-- >0;)for(n=M-1;n-- >0;)w<(r=t[M].distanceToSquared(t[n]))&&(w=r,o=t[M],i=t[n]);for(M=6,w=0;M-- >0;)r=H(o,i,t[M]),w<r&&(w=r,s=t[M]);for(u=T(o,i,s),c=u.dot(o),w=0,M=e;M-- >0;)r=Math.abs(points[M].dot(u)-c),w<r&&(w=r,a=points[M]);var B=points.indexOf(o),z=points.indexOf(i),S=points.indexOf(s),O=points.indexOf(a),G=[[S,z,B],[z,O,B],[S,O,z],[B,O,S]];y.subVectors(i,o).normalize(),E.subVectors(s,o).normalize(),h.subVectors(a,o).normalize(),h.dot((new THREE.Vector3).crossVectors(E,y))<0&&(G[0].reverse(),G[1].reverse(),G[2].reverse(),G[3].reverse());var C=points.slice();C.splice(C.indexOf(o),1),C.splice(C.indexOf(i),1),C.splice(C.indexOf(s),1),C.splice(C.indexOf(a),1);for(var M=G.length;M-- >0;)V(G[M],C,points),void 0!==G[M].visiblePoints&&g.push(G[M]),v.push(G[M]);!function(e){for(;g.length>0;)R(g.shift(),e)}(points);for(var P=v.length;P-- >0;)b.faces[P]=new THREE.Face3(v[P][2],v[P][1],v[P][0],v[P].normal);return b.normalsNeedUpdate=!0,b}}(),n=Math.PI/2,o={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron",MESH:"Trimesh"},i=function(e,i){var f;if((i=i||{}).type===o.BOX)return a(e);if(i.type===o.CYLINDER)return function(e,r){var o,i,s,a=new THREE.Box3,u=["x","y","z"],c=r.cylinderAxis||"y",f=u.splice(u.indexOf(c),1)&&u;if(a.setFromObject(e),!isFinite(a.min.lengthSq()))return null;return i=a.max[c]-a.min[c],s=.5*Math.max(a.max[f[0]]-a.min[f[0]],a.max[f[1]]-a.min[f[1]]),(o=new t.Cylinder(s,s,i,12))._type=t.Shape.types.CYLINDER,o.radiusTop=s,o.radiusBottom=s,o.height=i,o.numSegments=12,o.orientation=new t.Quaternion,o.orientation.setFromEuler("y"===c?n:0,"z"===c?n:0,0,"XYZ").normalize(),o}(e,i);if(i.type===o.SPHERE)return function(e,r){if(r.sphereRadius)return new t.Sphere(r.sphereRadius);var n=u(e);if(!n)return null;return n.computeBoundingSphere(),new t.Sphere(n.boundingSphere.radius)}(e,i);if(i.type===o.HULL)return function(e){var n,o,i,s,a=u(e);if(!a||!a.vertices.length)return null;for(n=0;n<a.vertices.length;n++)a.vertices[n].x+=1e-4*(Math.random()-.5),a.vertices[n].y+=1e-4*(Math.random()-.5),a.vertices[n].z+=1e-4*(Math.random()-.5);for(s=r(a),o=new Array(s.vertices.length),n=0;n<s.vertices.length;n++)o[n]=new t.Vec3(s.vertices[n].x,s.vertices[n].y,s.vertices[n].z);for(i=new Array(s.faces.length),n=0;n<s.faces.length;n++)i[n]=[s.faces[n].a,s.faces[n].b,s.faces[n].c];return new t.ConvexPolyhedron(o,i)}(e);if(i.type===o.MESH)return(f=u(e))?function(e){var r,n=c(e);if(!n.length)return null;return r=Object.keys(n).map(Number),new t.Trimesh(n,r)}(f):null;if(i.type)throw new Error('[CANNON.threeToCannon] Invalid type "%s".',i.type);if(!(f=u(e)))return null;switch(f.metadata?f.metadata.type:f.type){case"BoxGeometry":case"BoxBufferGeometry":return s(f);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var r,n=e.metadata?e.metadata.parameters:e.parameters;return(r=new t.Cylinder(n.radiusTop,n.radiusBottom,n.height,n.radialSegments))._type=t.Shape.types.CYLINDER,r.radiusTop=n.radiusTop,r.radiusBottom=n.radiusBottom,r.height=n.height,r.numSegments=n.radialSegments,r.orientation=new t.Quaternion,r.orientation.setFromEuler(THREE.Math.degToRad(90),0,0,"XYZ").normalize(),r}(f);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var r=e.boundingBox;return new t.Box(new t.Vec3((r.max.x-r.min.x)/2||.1,(r.max.y-r.min.y)/2||.1,(r.max.z-r.min.z)/2||.1))}(f);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return new t.Sphere((e.metadata?e.metadata.parameters:e.parameters).radius)}(f);case"TubeGeometry":case"Geometry":case"BufferGeometry":return a(e);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',f.type),s(f)}};function s(e){if(!c(e).length)return null;e.computeBoundingBox();var r=e.boundingBox;return new t.Box(new t.Vec3((r.max.x-r.min.x)/2,(r.max.y-r.min.y)/2,(r.max.z-r.min.z)/2))}function a(e){var r,n,o=new THREE.Box3,i=e.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),o.setFromObject(i),isFinite(o.min.lengthSq())?(r=new t.Box(new t.Vec3((o.max.x-o.min.x)/2,(o.max.y-o.min.y)/2,(o.max.z-o.min.z)/2)),(n=o.translate(i.position.negate()).getCenter(new THREE.Vector3)).lengthSq()&&(r.offset=n),r):null}function u(e){var t,r,n=function(e){var t=[];return e.traverse(function(e){"Mesh"===e.type&&t.push(e)}),t}(e),o=new THREE.Geometry,i=new THREE.Geometry;if(0===n.length)return null;if(1===n.length){var s=new THREE.Vector3,a=new THREE.Quaternion,u=new THREE.Vector3;return n[0].geometry.isBufferGeometry?n[0].geometry.attributes.position&&n[0].geometry.attributes.position.itemSize>2&&o.fromBufferGeometry(n[0].geometry):o=n[0].geometry.clone(),o.metadata=n[0].geometry.metadata,n[0].updateMatrixWorld(),n[0].matrixWorld.decompose(s,a,u),o.scale(u.x,u.y,u.z)}for(;r=n.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&&r.geometry.attributes.position.itemSize>2){var c=new THREE.Geometry;c.fromBufferGeometry(r.geometry),i.merge(c,r.matrixWorld),c.dispose()}}else i.merge(r.geometry,r.matrixWorld);return(t=new THREE.Matrix4).scale(e.scale),i.applyMatrix(t),i}function c(e){return e.attributes||(e=(new THREE.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}i.Type=o,e.threeToCannon=i});
//# sourceMappingURL=three-pathfinding.umd.js.map
